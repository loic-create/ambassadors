<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Outils Team for the Planet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --tftp-primary: #0096a2;
      --tftp-primary-alt: #0097a3;
      --tftp-light: #89e5d3;
      --tftp-dark: #002f33;
      --tftp-black: #0c0d0d;
      --radius-xl: 18px;
      --radius-md: 14px;
      --radius-pill: 999px;
      --bg-soft: rgba(255, 255, 255, 0.96);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top left, var(--tftp-light) 0%, #ffffff 40%, var(--tftp-dark) 100%);
      color: var(--tftp-black);
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    main.card {
      width: 100%;
      max-width: 1100px;
      background: var(--bg-soft);
      border-radius: var(--radius-xl);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.18);
      padding: 26px 26px 30px;
      backdrop-filter: blur(16px);
      border: 1px solid rgba(0, 151, 163, 0.18);
    }

    /* Top bar feel */
    main.card::before {
      content: "";
      display: block;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--tftp-primary), var(--tftp-light));
      margin-bottom: 12px;
      opacity: 0.9;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(0, 150, 162, 0.08);
      font-size: 11px;
      letter-spacing: 0.09em;
      color: var(--tftp-dark);
      font-weight: 500;
      text-transform: uppercase;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      background: var(--tftp-primary);
      border-radius: 999px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    @media (max-width: 720px) {
      body {
        padding: 12px;
      }
      main.card {
        padding: 18px 14px 22px;
        border-radius: 12px;
        box-shadow: 0 10px 22px rgba(0,0,0,0.16);
      }
      header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .logo-mark {
      width: 70px;
      height: 70px;
      border-radius: 22px;
      background: radial-gradient(circle at 30% 10%, var(--tftp-light), var(--tftp-primary));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 28px rgba(0, 151, 163, 0.35);
      flex-shrink: 0;
    }
    .logo-mark img {
      width: 46px;
      height: auto;
      display: block;
    }

    h1 {
      color: var(--tftp-dark);
      font-weight: 600;
      font-size: 24px;
      margin-bottom: 4px;
    }

    @media (max-width: 720px) {
      h1 {
        font-size: 20px;
      }
    }

    .subtitle {
      font-size: 13px;
      opacity: 0.86;
    }

    .page-intro {
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.7;
    }

    /* Sections */
    .features-layout {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-top: 18px;
    }

    /* Onglets */
    .tabs-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
      padding: 4px;
      border-radius: var(--radius-pill);
      background: rgba(255, 255, 255, 0.9);
      box-shadow: inset 0 0 0 1px rgba(0, 47, 51, 0.08);
      position: sticky;
      top: 0;
      z-index: 5;
    }

    @media (max-width: 720px) {
      .tabs-nav {
        position: static;
        border-radius: 12px;
      }
    }

    .tab-btn {
      border-radius: var(--radius-pill);
      border: none;
      background: transparent;
      font-size: 12px;
      padding: 8px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: rgba(0, 47, 51, 0.8);
      position: relative;
      transition: background 0.15s ease, color 0.15s ease, box-shadow 0.15s ease, transform 0.08s ease;
      white-space: nowrap;
    }

    .tab-btn:hover {
      background: rgba(0, 47, 51, 0.04);
      transform: translateY(-1px);
    }

    .tab-btn.active {
      background: linear-gradient(135deg, var(--tftp-primary), var(--tftp-primary-alt));
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(0, 150, 162, 0.35);
    }

    .tab-btn .num {
      display: inline-flex;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      align-items: center;
      justify-content: center;
      background: rgba(0, 150, 162, 0.12);
      color: var(--tftp-primary);
      font-size: 11px;
      font-weight: 600;
    }

    .tab-btn.active .num {
      background: rgba(0, 0, 0, 0.15);
      color: #ffffff;
    }

    .feature {
      background: rgba(255, 255, 255, 0.98);
      border-radius: var(--radius-md);
      border: 1px solid rgba(0, 47, 51, 0.08);
      padding: 18px 16px 16px;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.04);
      display: none; /* gÃ©rÃ© par les onglets */
    }

    .feature.is-active {
      display: block;
    }

    @media (max-width: 720px) {
      .feature {
        padding: 14px 12px 14px;
        border-radius: 10px;
      }
    }

    .feature-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .feature-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(0, 150, 162, 0.08);
      font-size: 11px;
      color: var(--tftp-dark);
    }

    .feature-badge .num {
      display: inline-flex;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      align-items: center;
      justify-content: center;
      background: var(--tftp-primary);
      color: white;
      font-size: 11px;
      font-weight: 600;
    }

    .feature-title {
      font-size: 15px;
      font-weight: 600;
      margin-top: 5px;
    }

    .feature-caption {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .helper {
      font-size: 11px;
      opacity: 0.7;
    }

    label {
      font-size: 12px;
      display: block;
      margin-bottom: 4px;
    }

    input[type="text"],
    select,
    textarea {
      font-family: inherit;
    }

    input[type="text"],
    select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(0, 47, 51, 0.18);
      padding: 7px 9px;
      font-size: 13px;
      outline: none;
      background: rgba(255, 255, 255, 0.95);
    }

    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--tftp-primary);
      box-shadow: 0 0 0 1px rgba(0, 150, 162, 0.22);
    }

    .btn-main {
      border: none;
      border-radius: var(--radius-pill);
      background: linear-gradient(135deg, var(--tftp-primary), var(--tftp-primary-alt));
      color: white;
      font-size: 13px;
      padding: 8px 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-main:hover {
      filter: brightness(1.05);
    }

    .btn-secondary {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(0, 47, 51, 0.28);
      background: rgba(0, 47, 51, 0.04);
      font-size: 12px;
      padding: 7px 14px;
      cursor: pointer;
    }

    .btn-outline {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(0, 47, 51, 0.35);
      background: transparent;
      font-size: 12px;
      padding: 7px 14px;
      cursor: pointer;
    }

    .btn-secondary:hover,
    .btn-outline:hover {
      background: rgba(0, 47, 51, 0.06);
    }

    .btn-link {
      border: none;
      background: none;
      padding: 0;
      font-size: 12px;
      cursor: pointer;
      color: var(--tftp-primary);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-link:hover {
      text-decoration: underline;
    }

    .small {
      font-size: 11px;
      opacity: 0.7;
    }

    /* Signature section */
    .sig-layout {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 14px;
      margin-top: 8px;
      align-items: flex-start;
    }
    @media (max-width: 720px) {
      .sig-layout {
        grid-template-columns: 1fr;
      }
    }

    .preview-wrapper {
      padding: 10px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(0, 0, 0, 0.06);
    }

    /* STORY GENERATOR (feature 2) */
    .story-wrapper {
      margin-top: 8px;
    }

    .story-step {
      display: none;
    }

    .story-step.active {
      display: block;
    }

    .story-step-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--tftp-dark);
    }

    .story-textarea {
      width: 100%;
      min-height: 80px;
      border-radius: 10px;
      border: 1px solid rgba(0, 47, 51, 0.18);
      padding: 7px 9px;
      font-size: 12px;
      resize: vertical;
      background: rgba(255, 255, 255, 0.96);
      outline: none;
    }

    .story-box {
      border-radius: 10px;
      border: 1px solid rgba(0, 47, 51, 0.16);
      padding: 10px;
      font-size: 13px;
      background: rgba(255, 255, 255, 0.9);
      white-space: pre-line;
      margin-top: 4px;
    }

    .story-btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .story-info {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 6px;
    }

    .story-error {
      font-size: 11px;
      color: #b91c1c;
      margin-top: 4px;
      display: none;
    }

    /* Photo section */
    .photo-layout {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 10px;
      margin-top: 8px;
      align-items: center;
    }
    @media (max-width: 720px) {
      .photo-layout {
        grid-template-columns: 1fr;
      }
    }

    .photo-info {
      font-size: 12px;
      opacity: 0.8;
    }

    .upload-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: var(--radius-pill);
      background: rgba(0, 150, 162, 0.08);
      font-size: 12px;
      cursor: pointer;
      margin-top: 10px;
      color: var(--tftp-dark);
    }
    .upload-label strong {
      font-weight: 600;
    }

    input[type="file"] {
      display: none;
    }

    canvas {
      width: 100%;
      max-width: 220px;
      border-radius: 22px;
      background: #f3f4f6;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.12);
      display: block;
      margin: 0 auto;
    }

    /* Posts section */
    .posts-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 860px) {
      .posts-grid {
        grid-template-columns: 1fr;
      }
    }

    .post-card {
      padding: 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(0, 47, 51, 0.12);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 6px;
    }

    .post-card p {
      font-size: 13px;
      line-height: 1.45;
      white-space: pre-line;
    }

    .post-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .copy-status {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 4px;
    }

    .section-note {
      margin-top: 6px;
      font-size: 11px;
      opacity: 0.7;
    }
  </style>
</head>

<body>
  <main class="card">
    <!-- HEADER -->
    <header>
      <div>
        <div class="pill">
          <span class="pill-dot"></span> Outils ambassadeur Â· Team for the Planet
        </div>
        <h1>Amplifie ton impact en quelques clics</h1>
        <p class="subtitle"></p>
        <p class="page-intro"></p>
      </div>
      <div class="logo-mark">
        <img src="https://i.imgur.com/7KlFQlw.png" alt="Team for the Planet" />
      </div>
    </header>

    <!-- FEATURES EN ONGLET -->
    <section class="features-layout">

      <div class="tabs-nav">
        <button class="tab-btn active" data-target="feature-signature">
          <span class="num">1</span> Signature email
        </button>
        <button class="tab-btn" data-target="feature-story">
          <span class="num">2</span> RÃ©cit perso
        </button>
        <button class="tab-btn" data-target="feature-photo">
          <span class="num">3</span> Photo de profil
        </button>
        <button class="tab-btn" data-target="feature-posts">
          <span class="num">4</span> Posts prÃªts Ã  poster
        </button>
      </div>

      <!-- FEATURE 1 : Signature email -->
      <section class="feature is-active" id="feature-signature">
        <div class="feature-header">
          <div>
            <div class="feature-badge">
              <span class="num">1</span>
              Signature email
            </div>
            <div class="feature-title">GÃ©nÃ¨re ta signature en 10 secondes</div>
          </div>
        </div>
        <p class="feature-caption"></p>

        <div class="sig-layout">
          <!-- FORM -->
          <div>
            <label for="fullName">
              PrÃ©nom + Nom <span class="helper">(obligatoire)</span>
            </label>
            <input type="text" id="fullName" placeholder="Ex. Coline Debayle" />

            <label for="company" style="margin-top:12px;">
              Entreprise <span class="helper">(facultatif)</span>
            </label>
            <input type="text" id="company" placeholder="Ex. Team for the Planet" />

            <button id="copySignatureButton" class="btn-main" style="margin-top:10px;">
              Copier la signature
            </button>
            <p id="statusText" class="small" style="margin-top:4px;"></p>
          </div>

          <!-- PREVIEW -->
          <div class="preview-wrapper">
            <p class="small" style="margin-bottom:4px; opacity:0.7;">AperÃ§u :</p>
            <div id="signaturePreview"></div>
          </div>
        </div>
      </section>

      <!-- FEATURE 2 : GÃ©nÃ©rateur de rÃ©cit personnel -->
      <section class="feature" id="feature-story">
        <div class="feature-header">
          <div>
            <div class="feature-badge">
              <span class="num">2</span>
              RÃ©cit perso
            </div>
            <div class="feature-title">Ton rÃ©cit Team for the Planet en 3 questions</div>
          </div>
        </div>
        <p class="feature-caption">
          RÃ©ponds aux questions, on te gÃ©nÃ¨re un texte prÃªt Ã  publier.
        </p>

        <div class="story-wrapper">
          <!-- Ã‰tape 1 -->
          <div id="step-1" class="story-step active">
            <div class="story-step-title">1/3 â€“ Comment tu as dÃ©couvert TFTP ?</div>
            <label for="q1"></label>
            <textarea id="q1" class="story-textarea" placeholder="Ex. Un ami mâ€™en a parlÃ©, jâ€™ai vu une vidÃ©o, je suis tombÃ© sur un post LinkedInâ€¦"></textarea>
            <button class="btn-main" id="next-1" style="margin-top:8px;">Suivant</button>
          </div>

          <!-- Ã‰tape 2 -->
          <div id="step-2" class="story-step">
            <div class="story-step-title">2/3 â€“ Ce que Ã§a a changÃ© pour toi</div>
            <label for="q2">Quâ€™est-ce que Ã§a a bougÃ© dans ta vie ?</label>
            <textarea id="q2" class="story-textarea" placeholder="Ex. Plus de sens, nouvelles habitudes, discussions autour de toiâ€¦"></textarea>
            <button class="btn-main" id="next-2" style="margin-top:8px;">Suivant</button>
          </div>

          <!-- Ã‰tape 3 -->
          <div id="step-3" class="story-step">
            <div class="story-step-title">3/3 â€“ Qui tu es aujourdâ€™hui</div>
            <label for="q3">Comment tu te sens / agis maintenant ?</label>
            <textarea id="q3" class="story-textarea" placeholder="Ex. Plus engagÃ©Â·e, plus utile, plus confiantÂ·eâ€¦"></textarea>
            <button class="btn-main" id="generate-btn" style="margin-top:8px;">GÃ©nÃ©rer mon texte</button>
          </div>

          <!-- Ã‰tape 4 : RÃ©sultat -->
          <div id="step-4" class="story-step">
            <div class="story-step-title" style="text-align:center;">ðŸŽ‰ Ton texte est prÃªt</div>
            <div id="story-output" class="story-box"></div>

            <div class="story-btn-row">
              <button class="btn-outline" id="copy-btn">Copier le texte</button>
              <button class="btn-secondary" id="share-linkedin-btn">Poster sur LinkedIn</button>
              <button class="btn-secondary" id="restart-btn">Recommencer</button>
            </div>

            <div id="copy-error" class="story-error"></div>
            <div class="story-info">
              Astuce : on copie le texte automatiquement si possible. Tu nâ€™as plus quâ€™Ã  le coller dans ton post.
            </div>
          </div>
        </div>
      </section>

      <!-- FEATURE 3 : Photo de profil + logo -->
      <section class="feature" id="feature-photo">
        <div class="feature-header">
          <div>
            <div class="feature-badge">
              <span class="num">3</span>
              Photo de profil
            </div>
            <div class="feature-title">Ajoute le logo Team for the Planet Ã  ta photo</div>
          </div>
        </div>
        <p class="feature-caption">
          Charge ta photo, on la recadre en cercle et on ajoute le logo.
        </p>

        <div class="photo-layout">
          <div>
            <p class="photo-info"></p>

            <label class="upload-label" for="fileInput">
              <strong>Choisir une photo</strong>
            </label>
            <input type="file" id="fileInput" accept="image/*" />

            <button id="downloadBtn" class="btn-secondary" style="margin-top:10px;" disabled>
              TÃ©lÃ©charger lâ€™image
            </button>
            <p id="photoStatus" class="small" style="margin-top:4px;">
              Aucune photo chargÃ©e pour lâ€™instant.
            </p>
          </div>

          <div style="text-align:center;">
            <canvas id="canvas" width="600" height="600"></canvas>
            <p class="small" style="margin-top:6px; opacity:0.7;"></p>
          </div>
        </div>
      </section>

      <!-- FEATURE 4 : Posts suggÃ©rÃ©s -->
      <section class="feature" id="feature-posts">
        <div class="feature-header">
          <div>
            <div class="feature-badge">
              <span class="num">4</span>
              Posts prÃªts Ã  poster
            </div>
            <div class="feature-title">Stock de posts clÃ©s en main</div>
          </div>
        </div>
        <p class="feature-caption"></p>

        <div class="posts-grid">
          <!-- POST 1 -->
          <article class="post-card">
            <p id="post1" class="post-text"></p>
            <button type="button" class="btn-link btn-read-more" data-target="post1">
              Lire la suite
            </button>
            <div class="post-actions">
              <button type="button" class="btn-outline btn-copy-post" data-target="post1">
                Copier le texte
              </button>
              <button type="button" class="btn-secondary btn-share-post" data-target="post1">
                Poster sur LinkedIn
              </button>
            </div>
            <div class="copy-status" data-status-for="post1"></div>
          </article>

          <!-- POST 2 -->
          <article class="post-card">
            <p id="post2" class="post-text"></p>
            <button type="button" class="btn-link btn-read-more" data-target="post2">
              Lire la suite
            </button>
            <div class="post-actions">
              <button type="button" class="btn-outline btn-copy-post" data-target="post2">
                Copier le texte
              </button>
              <button type="button" class="btn-secondary btn-share-post" data-target="post2">
                Poster sur LinkedIn
              </button>
            </div>
            <div class="copy-status" data-status-for="post2"></div>
          </article>

          <!-- POST 3 -->
          <article class="post-card">
            <p id="post3" class="post-text"></p>
            <button type="button" class="btn-link btn-read-more" data-target="post3">
              Lire la suite
            </button>
            <div class="post-actions">
              <button type="button" class="btn-outline btn-copy-post" data-target="post3">
                Copier le texte
              </button>
              <button type="button" class="btn-secondary btn-share-post" data-target="post3">
                Poster sur LinkedIn
              </button>
            </div>
            <div class="copy-status" data-status-for="post3"></div>
          </article>

          <!-- POST 4 -->
          <article class="post-card">
            <p id="post4" class="post-text"></p>
            <button type="button" class="btn-link btn-read-more" data-target="post4">
              Lire la suite
            </button>
            <div class="post-actions">
              <button type="button" class="btn-outline btn-copy-post" data-target="post4">
                Copier le texte
              </button>
              <button type="button" class="btn-secondary btn-share-post" data-target="post4">
                Poster sur LinkedIn
              </button>
            </div>
            <div class="copy-status" data-status-for="post4"></div>
          </article>
        </div>

        <p class="section-note"></p>
      </section>
    </section>
  </main>

  <!-- Fichier externe contenant les posts -->
  <script src="posts.js"></script>

  <script>
    /* ---------- 1. SIGNATURE EMAIL ---------- */

    const fullNameInput = document.getElementById("fullName");
    const companyInput  = document.getElementById("company");
    const preview       = document.getElementById("signaturePreview");
    const copySigButton = document.getElementById("copySignatureButton");
    const statusText    = document.getElementById("statusText");

    function getSignatureHTML() {
      const fullName = fullNameInput.value.trim() || "PrÃ©nom Nom";
      const company  = companyInput.value.trim();

      return `
<table cellpadding="0" cellspacing="0" style="font-family:'Poppins',Arial,sans-serif;font-size:13px;color:#0c0d0d;">
  <tr>
    <td valign="middle" style="padding-right:10px;">
      <img src="https://i.imgur.com/7KlFQlw.png" alt="Team for the Planet" style="max-height:42px;display:block;">
    </td>
    <td valign="middle" style="border-left:1px solid rgba(0,47,51,0.12);padding-left:10px;">
      <div style="font-weight:600;color:#002f33;">${fullName}</div>
      ${company ? `<div style="color:#0096a2;margin-top:2px;">${company}</div>` : ""}
      <div style="margin-top:6px;font-size:11px;color:#444;">
        Actionnaire de <strong>Team for the Planet</strong><br>
        <a href="https://www.team-planet.com" style="color:#0097a3;text-decoration:none;">www.team-planet.com</a>
      </div>
    </td>
  </tr>
</table>`;
    }

    function updateSignaturePreview() {
      preview.innerHTML = getSignatureHTML();
    }

    async function copySignature() {
      const html = getSignatureHTML();
      const text = html;

      try {
        if (navigator.clipboard && window.ClipboardItem) {
          const htmlBlob = new Blob([html], { type: "text/html" });
          const textBlob = new Blob([text], { type: "text/plain" });

          const item = new ClipboardItem({
            "text/html": htmlBlob,
            "text/plain": textBlob
          });

          await navigator.clipboard.write([item]);
        } else {
          const textarea = document.createElement("textarea");
          textarea.value = html;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          textarea.remove();
        }
        statusText.textContent = "Signature copiÃ©e ðŸŽ‰";
      } catch (e) {
        console.error(e);
        statusText.textContent = "Impossible de copier automatiquement, copie-colle le contenu de lâ€™aperÃ§u.";
      }
    }

    fullNameInput.addEventListener("input", updateSignaturePreview);
    companyInput.addEventListener("input", updateSignaturePreview);
    copySigButton.addEventListener("click", copySignature);
    updateSignaturePreview();

    /* ---------- 2. GÃ‰NÃ‰RATEUR DE RÃ‰CIT PERSONNEL (avec IA) ---------- */

    let storyStep = 1;
    const answers = { q1: "", q2: "", q3: "" };
    let generatedStory = "";

    function showStep(n) {
      for (let i = 1; i <= 4; i++) {
        const el = document.getElementById("step-" + i);
        if (!el) continue;
        el.classList.toggle("active", i === n);
      }
      storyStep = n;
    }

    function canUseClipboard() {
      return (
        typeof navigator !== "undefined" &&
        navigator.clipboard &&
        typeof navigator.clipboard.writeText === "function"
      );
    }

    document.getElementById("next-1").addEventListener("click", () => {
      answers.q1 = document.getElementById("q1").value || "";
      showStep(2);
    });

    document.getElementById("next-2").addEventListener("click", () => {
      answers.q2 = document.getElementById("q2").value || "";
      showStep(3);
    });

    document.getElementById("generate-btn").addEventListener("click", async () => {
      // On rÃ©cupÃ¨re la derniÃ¨re rÃ©ponse
      answers.q3 = document.getElementById("q3").value || "";

      // On construit le contexte envoyÃ© Ã  lâ€™IA
      const context =
        "Comment jâ€™ai dÃ©couvert Team for the Planet : " +
        (answers.q1 || "â€¦") +
        "\n" +
        "Ce que Ã§a a changÃ© pour moi : " +
        (answers.q2 || "â€¦") +
        "\n" +
        "Qui je suis / ce que je fais aujourdâ€™hui : " +
        (answers.q3 || "â€¦");

      const errorEl = document.getElementById("copy-error");
      const outputEl = document.getElementById("story-output");

      errorEl.style.display = "none";
      errorEl.textContent = "";

      // On passe tout de suite Ã  lâ€™Ã©cran de rÃ©sultat avec un message de loading
      showStep(4);
      outputEl.textContent = "GÃ©nÃ©ration en coursâ€¦ â³";

      try {
        const response = await fetch("/api/generate-post", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            context: context,
            // On fixe ici le ton souhaitÃ©
            tone:
              "Post LinkedIn clair, simple et inspirant, qui se termine par une invitation explicite Ã  dÃ©couvrir le site https://team-planet.com",
          }),
        });

        if (!response.ok) {
          throw new Error("HTTP " + response.status);
        }

        const data = await response.json();
        generatedStory = data.post || "";

        if (!generatedStory) {
          outputEl.textContent = "Aucun texte gÃ©nÃ©rÃ©.";
        } else {
          outputEl.textContent = generatedStory;
        }
      } catch (e) {
        console.error("Erreur gÃ©nÃ©ration IA", e);
        generatedStory = "";
        outputEl.textContent =
          "Impossible de gÃ©nÃ©rer le texte pour lâ€™instant. VÃ©rifie que le serveur Node (server.cjs.js) tourne bien sur http://localhost:3000, puis rÃ©essaie.";
      }
    });

    // Bouton "Copier le texte"
    document.getElementById("copy-btn").addEventListener("click", async () => {
      const errorEl = document.getElementById("copy-error");
      errorEl.style.display = "none";
      errorEl.textContent = "";

      if (!generatedStory) return;

      if (!canUseClipboard()) {
        errorEl.textContent =
          "La copie automatique nâ€™est pas disponible ici. SÃ©lectionne et copie le texte manuellement.";
        errorEl.style.display = "block";
        return;
      }

      try {
        await navigator.clipboard.writeText(generatedStory);
        errorEl.style.display = "block";
        errorEl.style.color = "#047857";
        errorEl.textContent = "Texte copiÃ© âœ…";
        setTimeout(() => {
          errorEl.style.display = "none";
        }, 2000);
      } catch (e) {
        console.error("Impossible de copier dans le presse-papiers", e);
        errorEl.textContent =
          "Impossible de copier automatiquement. SÃ©lectionne et copie le texte manuellement.";
        errorEl.style.display = "block";
        errorEl.style.color = "#b91c1c";
      }
    });

    // Bouton "Poster sur LinkedIn"
    document.getElementById("share-linkedin-btn").addEventListener(
      "click",
      async () => {
        if (!generatedStory) return;

        const errorEl = document.getElementById("copy-error");
        errorEl.style.display = "none";
        errorEl.textContent = "";

        // On tente de copier pour faciliter la vie
        if (canUseClipboard()) {
          try {
            await navigator.clipboard.writeText(generatedStory);
          } catch (e) {
            console.error("Impossible de copier dans le presse-papiers", e);
          }
        }

        const encoded = encodeURIComponent(generatedStory);
        const shareUrl =
          "https://www.linkedin.com/feed/?shareActive=true&text=" + encoded;
        window.open(shareUrl, "_blank", "noopener,noreferrer");
      }
    );

    document.getElementById("restart-btn").addEventListener("click", () => {
      generatedStory = "";
      answers.q1 = "";
      answers.q2 = "";
      answers.q3 = "";

      document.getElementById("q1").value = "";
      document.getElementById("q2").value = "";
      document.getElementById("q3").value = "";

      showStep(1);
    });

    /* ---------- 3. PHOTO + LOGO SUR CANVAS ---------- */

    const fileInput   = document.getElementById("fileInput");
    const canvas      = document.getElementById("canvas");
    const ctx         = canvas.getContext("2d");
    const downloadBtn = document.getElementById("downloadBtn");
    const photoStatus = document.getElementById("photoStatus");

    const logoImg = new Image();
    // mÃªme chemin que ton fichier dâ€™origine
    logoImg.src = "Logo-time-planet-.png";
    // Redessine quand le logo est chargÃ© (si lâ€™utilisateur a dÃ©jÃ  une image)
    logoImg.onload = () => {
      if (userImage) {
        drawPreview();
      }
    };

    let userImage = null;

    function drawPreview() {
      if (!userImage) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        return;
      }

      const size = Math.min(canvas.width, canvas.height);
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius  = size / 2 - 10;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Cercle de dÃ©coupe
      ctx.save();
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      // Dessine la photo en remplissant le cercle
      const imgRatio = userImage.width / userImage.height;
      const canvasRatio = canvas.width / canvas.height;

      let drawWidth, drawHeight, offsetX, offsetY;
      if (imgRatio > canvasRatio) {
        drawHeight = canvas.height;
        drawWidth = imgRatio * drawHeight;
        offsetX = (canvas.width - drawWidth) / 2;
        offsetY = 0;
      } else {
        drawWidth = canvas.width;
        drawHeight = drawWidth / imgRatio;
        offsetX = 0;
        offsetY = (canvas.height - drawHeight) / 2;
      }

      ctx.drawImage(userImage, offsetX, offsetY, drawWidth, drawHeight);
      ctx.restore();

      // Contour du cercle
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.strokeStyle = "rgba(255,255,255,0.9)";
      ctx.lineWidth = 6;
      ctx.stroke();

      // Logo centrÃ© vers le bas
      if (logoImg.complete) {
        const logoSize = radius * 0.7;
        const logoX = centerX - logoSize / 2;
        const logoY = centerY + radius - logoSize - radius * 0.08;

        ctx.save();
        ctx.beginPath();
        ctx.arc(centerX, logoY + logoSize / 2, logoSize / 2 + 4, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.fill();
        ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
        ctx.restore();
      }
    }

    fileInput.addEventListener("change", (event) => {
      const file = event.target.files && event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          userImage = img;
          drawPreview();
          downloadBtn.disabled = false;
          photoStatus.textContent = "Image chargÃ©e âœ… Tu peux la tÃ©lÃ©charger.";
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
      photoStatus.textContent = "Chargement de lâ€™imageâ€¦";
    });

    downloadBtn.addEventListener("click", () => {
      try {
        const dataURL = canvas.toDataURL("image/png");
        const link = document.createElement("a");
        link.download = "photo-profil-team-for-the-planet.png";
        link.href = dataURL;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        photoStatus.textContent = "Image tÃ©lÃ©chargÃ©e âœ…";
      } catch (e) {
        console.error("Erreur lors du tÃ©lÃ©chargement de lâ€™image", e);
        photoStatus.textContent =
          "Impossible de gÃ©nÃ©rer le tÃ©lÃ©chargement. VÃ©rifie ton navigateur ou les autorisations.";
      }
    });

    /* ---------- 4. POSTS PRÃŠTS Ã€ POSTER â†’ LIRE LA SUITE + COPIER / POSTER ---------- */

    // Injection des textes depuis posts.js + gestion "Lire la suite"
    if (Array.isArray(window.postsData)) {
      window.postsData.forEach((post) => {
        const p = document.getElementById(post.id);
        if (!p) return;

        const fullText = (post.text || "").trim();
        const lines = fullText.split("\n");
        const shortText =
          lines.length > 3 ? lines.slice(0, 3).join("\n") : fullText;

        p.dataset.fullText = fullText;
        p.dataset.shortText = shortText;
        p.innerText = shortText;
        p.setAttribute("data-expanded", "false");

        const article = p.closest(".post-card");
        if (!article) return;

        const readMoreBtn = article.querySelector(
          `.btn-read-more[data-target="${post.id}"]`
        );

        if (!readMoreBtn) return;

        if (lines.length <= 3) {
          // inutile d'afficher le bouton si le post tient sur 3 lignes
          readMoreBtn.style.display = "none";
          return;
        }

        readMoreBtn.addEventListener("click", () => {
          const expanded = p.getAttribute("data-expanded") === "true";
          if (expanded) {
            p.innerText = p.dataset.shortText;
            p.setAttribute("data-expanded", "false");
            readMoreBtn.textContent = "Lire la suite";
          } else {
            p.innerText = p.dataset.fullText;
            p.setAttribute("data-expanded", "true");
            readMoreBtn.textContent = "RÃ©duire";
          }
        });
      });
    }

    // Boutons "Copier le texte"
    const postCopyButtons = document.querySelectorAll(".btn-copy-post");
    postCopyButtons.forEach((btn) => {
      btn.addEventListener("click", async () => {
        const targetId = btn.getAttribute("data-target");
        const textEl = document.getElementById(targetId);
        if (!textEl) return;

        const text =
          (textEl.dataset && textEl.dataset.fullText) ||
          textEl.innerText.trim();
        if (!text) return;

        const statusEl = document.querySelector(
          `.copy-status[data-status-for="${targetId}"]`
        );

        if (navigator.clipboard && navigator.clipboard.writeText) {
          try {
            await navigator.clipboard.writeText(text);
            if (statusEl) {
              statusEl.textContent = "Texte copiÃ© âœ…";
            }
          } catch (e) {
            console.error(e);
            if (statusEl) {
              statusEl.textContent =
                "Impossible de copier automatiquement, copie-colle le texte manuellement.";
            }
          }
        } else if (statusEl) {
          statusEl.textContent =
            "SÃ©lectionne et copie le texte manuellement.";
        }
      });
    });

    // Boutons "Poster sur LinkedIn"
    const postShareButtons = document.querySelectorAll(".btn-share-post");
    postShareButtons.forEach((btn) => {
      btn.addEventListener("click", async () => {
        const targetId = btn.getAttribute("data-target");
        const textEl = document.getElementById(targetId);
        if (!textEl) return;

        const text =
          (textEl.dataset && textEl.dataset.fullText) ||
          textEl.innerText.trim();
        if (!text) return;

        const statusEl = document.querySelector(
          `.copy-status[data-status-for="${targetId}"]`
        );

        if (navigator.clipboard && navigator.clipboard.writeText) {
          try {
            await navigator.clipboard.writeText(text);
            if (statusEl) {
              statusEl.textContent = "Texte copiÃ©, LinkedIn sâ€™ouvreâ€¦ âœ…";
            }
          } catch (e) {
            console.error(e);
            if (statusEl) {
              statusEl.textContent =
                "LinkedIn sâ€™ouvre. Si besoin, copie le texte manuellement.";
            }
          }
        } else if (statusEl) {
          statusEl.textContent =
            "LinkedIn sâ€™ouvre. Si besoin, copie le texte manuellement.";
        }

        const encoded = encodeURIComponent(text);
        const shareUrl =
          "https://www.linkedin.com/feed/?shareActive=true&text=" + encoded;
        window.open(shareUrl, "_blank", "noopener,noreferrer");
      });
    });

    /* ---------- 5. GESTION DES ONGLETS ---------- */

    const tabButtons = document.querySelectorAll(".tab-btn");
    const featureSections = document.querySelectorAll(".feature");

    function activateTab(targetId) {
      featureSections.forEach((section) => {
        if (section.id === targetId) {
          section.classList.add("is-active");
        } else {
          section.classList.remove("is-active");
        }
      });

      tabButtons.forEach((btn) => {
        if (btn.getAttribute("data-target") === targetId) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-target");
        if (!targetId) return;
        activateTab(targetId);
      });
    });

    // Onglet initial
    activateTab("feature-signature");
  </script>
</body>
</html>
